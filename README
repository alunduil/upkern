----
About
----

Author: Alex Brandt <alunduil@alunduil.com>
Date: 2010/02/25
Web URL: http://www.alunduil.com/programs/upkern
Bugzilla URL: http://bugzilla.alunduil.com

----
Description
----

This utility is a batch kernel updating utility written specifically
for the Gentoo Linux (TM) meta-distribution.  

----
Installation
----

$python setup.py install

----
Dependencies
----

Python packages not provided but needed by the script:
 - gentoolkit (>=0.3)
 - portage

----
Example input and output
----

Input :: upkern [options] [sources]
 - sources must fit inside the following regex: 
   '(?:sys-kernel/)?
    (?:(?P<sources>[A-Za-z0-9+_][A-Za-z0-9+_-]*)-sources-)?
    (?P<version>[A-Za-z0-9+_][A-Za-z0-9+_.-]*)'
 - examples:
   'sys-kernel/gentoo-sources-2.6.32-r6'
   'gentoo-sources-2.6.23-r6'
   '2.6.33-r6' (gentoo-sources will be assumed)
   'vanilla-sources-2.6.33' (other sources can be specified as well)

Output :: 
 - there are three output styles available: 
   * verbose
   * debug
   * dry-run
   * quiet
 - example (dry-run):
   Preparing the kernel sources ...
   Finding the owner of linux-3.3.1-gentoo  ... done!
   rm /usr/src/linux
   ln -s /usr/src/linux-3.3.1-gentoo /usr/src/linux
   cp /usr/src/linux/.config{,.bak}
   cp /boot/config-3.3.1-gentoo /usr/src/linux/.config
   rm /usr/src/linux/.config.bak
   Kernel sources prepared.
   Configuratin kernel sources ...
   pushd /usr/src/linux
   make -j5 oldconfig
   popd
   Kernel sources configured.
   Building the kernel sources ...
   pushd /usr/src/linux
   make -j5 && make -j5 modules_install
   popd
   Kernel sources built.
   Rebuilding the kernel modules ...
   module-rebuild -X rebuild
   Kernel modules rebuilt.
   pushd /usr/src/linux
   cp arch/x86_64/boot/bzImage /boot/bzImage-3.3.1-gentoo
   cp .config /boot/config-3.3.1-gentoo
   cp System.map /boot/System.map-3.3.1-gentoo
   cp System.map /System.map
   popd
   cp /boot/grub/grub.conf{,.bak}
   cat > /boot/grub/grub.conf
   # This is a sample grub.conf for use with Genkernel, per the Gentoo handbook
   # http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=1&chap=10#doc_chap2
   # If you are not using Genkernel and you need help creating this file, you
   # should consult the handbook. Alternatively, consult the grub.conf.sample that
   # is included with the Grub documentation.

   default 4
   timeout 3
   splashimage=(hd0,0)/boot/grub/splash.xpm.gz

   # vim:ft=conf:

   # Kernel added on 2012-02-07 19:21:06.305820:
   title=linux-3.2.5-gentoo
     root (hd0,0)
     kernel /boot/bzImage-3.2.5-gentoo root=/dev/sda3 fastboot rootfstype=ext4

   # Kernel added on 2012-02-13 19:11:19.584541:
   title=linux-3.2.6-gentoo
     root (hd0,0)
     kernel /boot/bzImage-3.2.6-gentoo root=/dev/sda3 fastboot rootfstype=ext4

   # Kernel added on 2012-03-15 09:09:49.147355:
   title=linux-3.2.11-gentoo
     root (hd0,0)
     kernel /boot/bzImage-3.2.11-gentoo root=/dev/sda3 fastboot rootfstype=ext4
     
   # Kernel added on 2012-03-22 12:13:50.447946:
   title=linux-3.3.0-gentoo
     root (hd0,0)
     kernel /boot/bzImage-3.3.0-gentoo root=/dev/sda3 fastboot rootfstype=ext4

   # Kernel added 2012-04-05 22:16:25.099744:
   title=linux-3.3.1-gentoo
     root (hd0,0)
     kernel /boot/bzImage-3.3.1-gentoo root=/dev/sda3   fastboot rootfstype=ext4
   ^d
   rm /boot/grub/grub.conf.bak
   The kernel, linux-3.3.1-gentoo, has been successfully installed.  Please, check that all configuration files are installed correctly and the bootloader is configured correctly.  The kernel's build time was 0:00:00.000189

